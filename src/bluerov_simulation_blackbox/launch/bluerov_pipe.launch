<launch>
    <!-- Configurable arguments -->
    <arg name="robot_name" default="bluerov2" />

    <arg name="enable_joystick" default="true" />
    <arg name="joystick_device" default="/dev/input/js0" />

    <arg name="enable_rviz" default="true" />
    <arg name="enable_gui" default="true" /> <!-- for iquaview -->

    <!-- Simulation parameters -->
    <arg name="simulation_data" value="$(find bluerov_simulation_blackbox)/resources" />
    <arg name="scenario_description"
        value="$(find bluerov_simulation_blackbox)/scenarios/bluerov_pipe.scn" />
    <arg name="simulation_rate" value="300.0" />
    <arg name="graphics_resolution" value="1200 800" />
    <arg name="graphics_quality" value="high" />

    <!-- Static transform -->
    
    <node name="world2ned" pkg="tf2_ros" type="static_transform_publisher"
        args="0 0 0 3.1415 0 3.1415 world world_ned" />
        
    <include file="$(find bluerov_simulation_blackbox)/launch/cirtesu_description.launch"/>
    
    <group ns="blackbox">
        <param name="robot_description" command="$(find xacro)/xacro '$(find bluerov_simulation_blackbox)/urdf/blackbox.xacro'" />
                        
        <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher"
            output="screen">
        <param name="publish_frequency" type="double" value="50.0"/>
        <param name="robot_namespace" value="blackbox"/>
        </node>
        
        <!-- Static transform -->
        <node name="nedtocirtesu" pkg="tf2_ros" type="static_transform_publisher"
            args="0 0 0 3.1416 0 0 world_ned cirtesu_base_link" />
    </group>

    <!-- Namespace with robot name -->
    <group ns="$(arg robot_name)">

        <!-- Joystick -->
        <!-- <group if="$(arg enable_joystick)">
            <node name="joystick" pkg="joy" type="joy_node">
                <param name="dev" value="$(arg joystick_device)" />
                <param name="dev_ff" value="" />
                <param name="deadzone" value="0.05" />
            </node>
            <node name="fx10_to_teleoperation" pkg="cola2_control"
                type="logitech_fx10_to_teleoperation_node.py" />
        </group> -->

        <!-- Load robot description -->
        <param name="robot_description" command="$(find xacro)/xacro '$(find bluerov_simulation_blackbox)/urdf/config.xacro'" />
    

        <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher"
            output="screen" />

        <!-- Run Simulator -->
        <node name="stonefish_simulator" pkg="stonefish_ros" type="parsed_simulator"
            args="$(arg simulation_data) $(arg scenario_description)
                  $(arg simulation_rate) $(arg graphics_resolution) 
                  $(arg graphics_quality)"
            output="screen">
            <remap from="bravo/joint_states" to="joint_states" />
            <remap from="/stonefish/blackbox/odom" to="blackbox_odom" />
        </node>

    </group>



    <!-- Stonefish/COLA2 message translator -->
    <!-- <node name="translator" pkg="cola2_stonefish" type="cola2_stonefish_node">
        <remap from="/translator/stonefish_dvl" to="/$(arg robot_name)/navigator/dvl_sim" />
        <remap from="/translator/cola2_dvl" to="/$(arg robot_name)/navigator/dvl" />
        <remap from="/translator/stonefish_thruster_setpoints"
            to="/$(arg robot_name)/controller/thruster_setpoints_sim" />
        <remap from="/translator/cola2_thruster_setpoints"
            to="/$(arg robot_name)/controller/thruster_setpoints" />
        <remap from="/translator/stonefish_navigation"
            to="/$(arg robot_name)/navigator/navigation_sim" />
        <remap from="/translator/cola2_navigation" to="/$(arg robot_name)/navigator/navigation" />
    </node> -->

    <!-- RViz -->
    <node if="$(arg enable_rviz)" pkg="rviz" type="rviz" name="rviz"
        args="-d $(find bluerov_simulation_blackbox)/config/rviz/bluerov_blackbox.rviz" />
</launch>
